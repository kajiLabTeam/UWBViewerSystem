#!/bin/bash

# SwiftFormatを実行してコードをフォーマット
echo "SwiftFormatを実行中..."

# Swift Formatが利用可能か確認
if command -v swift-format &> /dev/null; then
    # 全てのSwiftファイルをフォーマット
    find UWBViewerSystem -name "*.swift" -type f -exec swift-format --in-place --configuration .swift-format {} +
    echo "✅ SwiftFormat完了"
else
    echo "⚠️ Warning: swift-format not found. Please install it via: brew install swift-format"
fi

# フォーマット後の変更があれば、コミットを促す
if [[ $(git diff --name-only) ]]; then
    echo "❌ ファイルがフォーマットされました。プッシュ前にフォーマット済みの変更をコミットしてください。"
    exit 1
fi

# Swift Testingを実行
echo "Swift Testingを実行中..."

# Swift Testing専用でテストを実行
if swift test --enable-swift-testing --disable-xctest --parallel; then
    echo "✅ すべてのテストが通過しました"
else
    echo "❌ テストが失敗しました。プッシュを中止します。"
    echo "修正後に再度プッシュしてください。"
    exit 1
fi

echo "🚀 pre-pushチェック完了。プッシュを続行します。"
exit 0
